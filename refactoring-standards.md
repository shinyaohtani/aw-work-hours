# リファクタリング規準書

> **📁 ナビゲーション**
> - ↑ [docs/](README.md) - 親ディレクトリ

## 1. 基本方針

- Pythonなどのコードをスマートかつ読みやすい形にリファクタリングすることを目的とする。
- コード全体の構造を見ただけで流れが把握できるように整理する。

## 2. リファクタリング手順

- コード全体の構成を理解したうえで、
- 必要に応じてクラス分割、責務の明確化を行い、
- 処理の簡素化や統合を実施してスマートな構成に変換し、
- 代替の全コードを提示し、コードのフローや設計意図を簡単に説明し、
- 曖昧な点がある場合はに確認しつつ、基本的には意図を汲み取り進めてください。
- 全ての指示に合致しているか確認し、合致していない部分が見つかったら最初からやり直してください。
- コード実行結果が変更されてしまう場合、リファクタリング失敗であるため、やり直してください。

## 3. モノ指向クラス設計

- とにかくオブジェクト指向を基礎概念として扱い、主体をクラスにして、少しでも動作を示唆するものはクラスにしないでください。
- 動詞や"-er"、"-or"、動詞にもなり得る言葉で終わるような名称は動作を示唆しているためクラスとしては適切ではありません。例: MailFormattor
- クラスにするものはassetやresult、structureなどモノに特化し、runnerやtranslator, matcher, exportorなど機能をクラスにはしないでください。
- とにかくオブジェクト指向を基礎概念として扱い、メソッド名は「オブジェクトが何をするか、またはオブジェクトの何か」を表す視点で命名してください。
- get_は私の命名規約に合致しないので削除し、例えばXXX_authクラスのurlにアクセスする場合はurlプロパティのように命名してください。
- クラスが多いことは問題ではありません。
- クラス名を見てそのクラスが何をするクラスなのか、全体はどのような流れなのかが理解できるようにしてください。
- すべてのメソッドはクラスに含めてください。クラスの外でメソッドを定義しないでください。

## 4. メソッド・クラス構造制約

- クラスにはメソッドが4個か5個になるようにしてください。 3個では少なすぎます。6個では多すぎます。
- メソッドは必ず25行以下に短くしてください。26行以上になる場合は2つのメソッドに分割してください。
- privateメソッドとpublicメソッドは“_”を接頭辞にして区別してください。
- すべて型を明記してください。メソッド引数・返り値・変数など全てです。pythonの場合、Optional表記ではなく新しい "| None"などを使ってください。

## 5. 命名規約

- メソッド名や変数名、クラス名は、それが担う機能や役割が明確になるように命名してください。
- 抽象的で意味をなさない*info*、*data*、*manager*、*process*、*asset*という言葉は変数名やクラス名に使わないでください。
- pathはabsolute pathとrelative pathで大きく扱いが異なるので、必ず_abspathか_relpathを接尾語として入れてください。
- file nameはfname、directory nameはdirnameと一貫して略すことで、fnameやdirnameはパスを含まない純粋なファイル名やディレクトリ名を扱うものとしてください。
- listやdictも意味をなさないことが多いです。複数であることを伝えたいだけなら**“s”**をつけるなどで簡潔に表現してください。
- Snake caseを使い、total_failuresのように表現してください。
- 極力1単語で表現し、どうしても1単語では常に誤解を招く場合のみ、Snake caseで繋いでください。その場合は誤解についての評価結果を考えてください。

## 6. 差分チェック対応

- 挙動がstdout, stderr, file outputを含め1mmも変えないようにしてください。
- コード差分チェックのため、後段で「次の2つのコードは同じ目的のために作られたコードです。挙動がまったく同じになるかどうか分析してください。」が問題なく通るようなリファクタリングを行ってください。
